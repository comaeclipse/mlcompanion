---
import Layout from "../layouts/Layout.astro";
import Breadcrumb from "../components/Breadcrumb.astro";
import { getSessionFromRequest } from "../lib/auth";
import { ManagePortal } from "../components/ManagePortal";

const result = await getSessionFromRequest(Astro.request);
if (!result?.user) {
  return Astro.redirect("/login");
}

const url = new URL(Astro.request.url);
const tabParam = url.searchParams.get("tab");
const activeTab =
  tabParam === "books"
    ? "books"
    : tabParam === "authors"
      ? "authors"
      : tabParam === "channels"
        ? "channels"
        : tabParam === "podcasts"
          ? "podcasts"
          : "videos";
---

<Layout title="Manage - MLCompanion">
  <div class="page">
    <Breadcrumb items={[{ label: "Home", href: "/" }, { label: "Manage" }]} />
  </div>
  <ManagePortal client:load initialTab={activeTab} />
</Layout>
